import{n as s,p as e,b as a,r as t,c as l,w as r,i as o,o as u,d as c,e as d,t as n,f as i,q as f,u as p,F as _,g,j as m}from"./index-CqNzDXlw.js";import{_ as h}from"./uni-id-pages-avatar.B2BhULPx.js";import{r as v}from"./uni-app.es.BltvyIiY.js";import{s as C}from"./store.DvWIVlV-.js";import{_ as w,a as k}from"./wallet-red.Cfw-DLU5.js";import{_ as F}from"./_plugin-vue_export-helper.BCo6x5W8.js";import"./uni-icons.EE9020IA.js";const y=F({computed:{userInfo:()=>C.userInfo},data:()=>({allGoods:[],randomGoods:[],orderCounts:{1:0,2:0,3:0,4:0,5:0}}),onLoad(){this.getGoods()},onShow(){this.fetchOrderCounts()},methods:{async getGoods(){try{const{result:{data:e}}=await s.database().collection("mall-goods").get();this.allGoods=e||[],this.randomGoods=this.getRandomGoods(16)}catch(e){console.error("获取商品数据失败:",e)}},getRandomGoods(s){return[...this.allGoods].sort((()=>Math.random()-.5)).slice(0,s)},async fetchOrderCounts(){if(C.userInfo&&C.userInfo._id)try{const e=s.database(),[a,t,l,r,o]=await Promise.all([e.collection("order").where({userId:C.userInfo._id,paymentStatus:0}).count(),e.collection("order").where({userId:C.userInfo._id,paymentStatus:1,shareStatus:0}).count(),e.collection("order").where({userId:C.userInfo._id,paymentStatus:1,shippingStatus:0}).count(),e.collection("order").where({userId:C.userInfo._id,shippingStatus:1,deliveryStatus:0}).count(),e.collection("order").where({userId:C.userInfo._id,deliveryStatus:1,review:e.command.exists(!1)}).count()]);this.orderCounts={1:a.result.total,2:t.result.total,3:l.result.total,4:r.result.total,5:o.result.total}}catch(e){console.error("获取订单数量失败:",e)}},navigateToProduct(s){s&&(e({key:"currentProduct",data:s,success:()=>{console.log("商品信息存储成功",s)}}),a({url:"../search/mall-details"}))},navigateToAddress(){a({url:"/pages/address/address"})},viewAllOrders(){a({url:"/pages/user/order"})},navigateToOrder(s){a({url:`/pages/user/order?type=${s}`})},goSet(){a({url:"/pages/user/set"})},navigateToFeature(s){a({url:{favor:"/pages/malls-manage/favor",wallet:"/pages/wallet/wallet",coupon:"/pages/coupon/coupon-list",history:"/pages/malls-manage/history",refund:"/pages/orders/refund-list"}[s]})},goSet(){a({url:"/pages/user/set"})}}},[["render",function(s,e,a,C,F,y){const I=o,b=v(t("uni-id-pages-avatar"),h),T=g,S=m;return u(),l(I,{class:"container"},{default:r((()=>[c(I,{class:"status-bar"}),c(I,{class:"user-header"},{default:r((()=>[c(I,{class:"user-info"},{default:r((()=>[c(I,{class:"avatar-wrapper"},{default:r((()=>[c(b,{width:"100rpx",height:"100rpx"})])),_:1}),c(I,{class:"user-meta"},{default:r((()=>[c(I,{class:"nickname-row"},{default:r((()=>[c(T,{src:"/assets/user-icon-0FLY8y0n.png",mode:"aspectFit",class:"wechat-icon"}),c(S,{class:"nickname"},{default:r((()=>[d(n(y.userInfo.username||"您的昵称"),1)])),_:1})])),_:1}),c(I,{class:"address",onClick:y.goSet},{default:r((()=>[c(T,{src:w,mode:"aspectFit",class:"wechat-icon"}),c(S,{class:"address-text"},{default:r((()=>[d(n(y.userInfo.address&&y.userInfo.address.length>6?y.userInfo.address.substr(0,6)+"...":y.userInfo.address||"收货地址"),1)])),_:1})])),_:1},8,["onClick"])])),_:1})])),_:1}),c(I,{class:"header-buttons"},{default:r((()=>[c(I,{class:"pindan-btn"},{default:r((()=>[c(T,{src:"/assets/coupon-DzltuKQu.png",mode:"aspectFit",class:"settings-icon"}),c(S,null,{default:r((()=>[d("拼单返券")])),_:1})])),_:1}),c(I,{class:"pindan-btn"},{default:r((()=>[c(T,{src:"/assets/set-BJqdCXFW.png",mode:"aspectFit",class:"settings-icon",onClick:y.goSet},null,8,["onClick"]),c(S,null,{default:r((()=>[d("设置")])),_:1})])),_:1})])),_:1})])),_:1}),c(I,{class:"monthly-card"},{default:r((()=>[c(S,{class:"card-title"},{default:r((()=>[d("省钱月卡")])),_:1}),c(S,{class:"card-desc"},{default:r((()=>[d("到账提醒: 124元补贴待领 >")])),_:1})])),_:1}),c(I,{class:"orders-section"},{default:r((()=>[c(I,{class:"orders-header"},{default:r((()=>[c(S,{class:"title"},{default:r((()=>[d("我的订单")])),_:1}),c(I,{class:"view-all",onClick:y.viewAllOrders},{default:r((()=>[c(S,null,{default:r((()=>[d("查看全部")])),_:1}),c(S,{class:"arrow"},{default:r((()=>[d(">")])),_:1})])),_:1},8,["onClick"])])),_:1}),c(I,{class:"order-status"},{default:r((()=>[c(I,{class:"status-item",onClick:e[0]||(e[0]=s=>y.navigateToOrder("pending"))},{default:r((()=>[c(I,{class:"icon-wrapper"},{default:r((()=>[c(T,{src:"/assets/wallet-C4uRVfxV.png",mode:"aspectFit",class:"status-icon"}),F.orderCounts[1]>0?(u(),l(I,{key:0,class:"badge"},{default:r((()=>[d(n(F.orderCounts[1]),1)])),_:1})):i("",!0)])),_:1}),c(S,null,{default:r((()=>[d("待付款")])),_:1})])),_:1}),c(I,{class:"status-item",onClick:e[1]||(e[1]=s=>y.navigateToOrder("share"))},{default:r((()=>[c(I,{class:"icon-wrapper"},{default:r((()=>[c(T,{src:"/assets/share-p-xXMBX_.png",mode:"aspectFit",class:"status-icon"}),F.orderCounts[2]>0?(u(),l(I,{key:0,class:"badge"},{default:r((()=>[d(n(F.orderCounts[2]),1)])),_:1})):i("",!0)])),_:1}),c(S,null,{default:r((()=>[d("待分享")])),_:1})])),_:1}),c(I,{class:"status-item",onClick:e[2]||(e[2]=s=>y.navigateToOrder("shipping"))},{default:r((()=>[c(I,{class:"icon-wrapper"},{default:r((()=>[c(T,{src:"/assets/shipping-HQm6rYkN.png",mode:"aspectFit",class:"status-icon"}),F.orderCounts[3]>0?(u(),l(I,{key:0,class:"badge"},{default:r((()=>[d(n(F.orderCounts[3]),1)])),_:1})):i("",!0)])),_:1}),c(S,null,{default:r((()=>[d("待发货")])),_:1})])),_:1}),c(I,{class:"status-item",onClick:e[3]||(e[3]=s=>y.navigateToOrder("receiving"))},{default:r((()=>[c(I,{class:"icon-wrapper"},{default:r((()=>[c(T,{src:"/assets/delivery-DO47THFz.png",mode:"aspectFit",class:"status-icon"}),F.orderCounts[4]>0?(u(),l(I,{key:0,class:"badge"},{default:r((()=>[d(n(F.orderCounts[4]),1)])),_:1})):i("",!0)])),_:1}),c(S,null,{default:r((()=>[d("待收货")])),_:1})])),_:1}),c(I,{class:"status-item",onClick:e[4]||(e[4]=s=>y.navigateToOrder("review"))},{default:r((()=>[c(I,{class:"icon-wrapper"},{default:r((()=>[c(T,{src:"/assets/star-D6e4F8Ij.png",mode:"aspectFit",class:"status-icon"}),F.orderCounts[5]>0?(u(),l(I,{key:0,class:"badge"},{default:r((()=>[d(n(F.orderCounts[5]),1)])),_:1})):i("",!0)])),_:1}),c(S,null,{default:r((()=>[d("评价")])),_:1})])),_:1})])),_:1})])),_:1}),c(I,{class:"features-section"},{default:r((()=>[c(I,{class:"feature-item",onClick:e[5]||(e[5]=s=>y.navigateToFeature("favor"))},{default:r((()=>[c(T,{src:"/assets/heart-COiJVbcM.png",mode:"aspectFit",class:"feature-icon"}),c(S,null,{default:r((()=>[d("商品收藏")])),_:1})])),_:1}),c(I,{class:"feature-item",onClick:e[6]||(e[6]=s=>y.navigateToFeature("wallet"))},{default:r((()=>[c(T,{src:k,mode:"aspectFit",class:"feature-icon"}),c(S,null,{default:r((()=>[d("多多钱包")])),_:1})])),_:1}),c(I,{class:"feature-item",onClick:e[7]||(e[7]=s=>y.navigateToFeature("coupon"))},{default:r((()=>[c(T,{src:"/assets/coupon-DzltuKQu.png",mode:"aspectFit",class:"feature-icon"}),c(S,null,{default:r((()=>[d("优惠券")])),_:1})])),_:1}),c(I,{class:"feature-item",onClick:e[8]||(e[8]=s=>y.navigateToFeature("history"))},{default:r((()=>[c(T,{src:"/assets/history-xoBvPARg.png",mode:"aspectFit",class:"feature-icon"}),c(S,null,{default:r((()=>[d("历史浏览")])),_:1})])),_:1}),c(I,{class:"feature-item",onClick:e[9]||(e[9]=s=>y.navigateToFeature("refund"))},{default:r((()=>[c(T,{src:"/assets/refund-DL7ljMgG.png",mode:"aspectFit",class:"feature-icon"}),c(S,null,{default:r((()=>[d("退款售后")])),_:1})])),_:1})])),_:1}),c(I,{class:"content"},{default:r((()=>[c(I,{class:"tab-content"},{default:r((()=>[(u(!0),f(_,null,p(F.randomGoods,((s,e)=>(u(),l(I,{key:e,class:"content-item"},{default:r((()=>[c(I,{class:"product-card",onClick:e=>y.navigateToProduct(s)},{default:r((()=>{var e;return[c(T,{class:"item-image",src:null==(e=s.goods_thumb)?void 0:e.fileID,mode:"aspectFill"},null,8,["src"]),c(I,{class:"product-info"},{default:r((()=>[c(S,{class:"item-title"},{default:r((()=>[d(n(s.name),1)])),_:2},1024),c(I,{class:"service-tags"},{default:r((()=>[c(S,{class:"tag pay-later"},{default:r((()=>[d("先用后付")])),_:1}),c(S,{class:"tag quick-refund"},{default:r((()=>[d("极速退款")])),_:1})])),_:1}),c(I,{class:"price-row"},{default:r((()=>[c(S,{class:"price"},{default:r((()=>[d("¥"+n(s.price),1)])),_:2},1024),c(S,{class:"sales"},{default:r((()=>[d("全店已拼"+n(s.total_sell_count)+"+件",1)])),_:2},1024)])),_:2},1024)])),_:2},1024)]})),_:2},1032,["onClick"])])),_:2},1024)))),128))])),_:1})])),_:1})])),_:1})}],["__scopeId","data-v-5b938f4f"]]);export{y as default};
