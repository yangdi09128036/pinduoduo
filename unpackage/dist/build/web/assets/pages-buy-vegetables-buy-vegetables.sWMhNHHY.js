import{n as a,b as s,a as e,p as t,c as l,w as c,i as r,o,d as n,q as i,u as d,F as u,e as h,g as f,I as g,a9 as _,S as m,x as p,t as b,aa as y,j as k}from"./index-CqNzDXlw.js";import{_ as T}from"./left.CpwphMH_.js";import{_ as v,a as w}from"./camera.sMgFRGYR.js";import{_ as C}from"./_plugin-vue_export-helper.BCo6x5W8.js";const x=C({data:()=>({currentTab:0,searchPlaceholder:"请输入商品信息",categories:[],currentTabData:[],allGoods:[],banners:[]}),onLoad(){this.getInitialData()},methods:{async getInitialData(){try{await Promise.all([this.getCategories(),this.getGoods(),this.getBanners()]),this.switchTab(0),this.allGoods.length>0&&(this.searchPlaceholder=this.allGoods[Math.floor(Math.random()*this.allGoods.length)].keywords||"请输入商品信息")}catch(a){console.error("获取数据失败:",a)}},async getCategories(){try{const{result:{data:s}}=await a.database().collection("mall-categories").get();this.categories=s||[]}catch(s){console.error("获取分类数据失败:",s)}},async getGoods(){try{const{result:{data:s}}=await a.database().collection("mall-goods").get();this.allGoods=s||[]}catch(s){console.error("获取商品数据失败:",s)}},async getBanners(){try{const{result:{data:s}}=await a.database().collection("banner").get(),e=s[0]||{};this.banners=e.banner_imgs.slice(0,6).map((a=>a.fileID||a.url))}catch(s){console.error("获取轮播图数据失败:",s)}},switchTab(a){this.currentTab=a;const s=this.categories[a];if(s)if(0===a){const a=[...this.allGoods].sort((()=>Math.random()-.5));this.currentTabData=a.slice(0,30)}else this.currentTabData=this.allGoods.filter((a=>parseInt(a.category_id)===parseInt(s.sort)))},navigateToSearch(){s({url:"/pages/search/search"})},navBack(){e({url:"/pages/index/index"})},navigateToProduct(a){a&&(t({key:"currentProduct",data:a,success:()=>{console.log("商品信息存储成功",a)}}),s({url:"../search/mall-details"}))}}},[["render",function(a,s,e,t,C,x){const G=f,I=g,D=r,P=y,F=_,j=k,B=m;return o(),l(D,{class:"container"},{default:c((()=>[n(D,{class:"fixed-head"},{default:c((()=>[n(D,{class:"search-container"},{default:c((()=>[n(G,{class:"back-icon",src:T,mode:"aspectFit",onClick:x.navBack},null,8,["onClick"]),n(D,{class:"search-box",onClick:x.navigateToSearch},{default:c((()=>[n(G,{class:"search-icon",src:v,mode:"aspectFit"}),n(I,{class:"search-input",type:"text",placeholder:C.searchPlaceholder},null,8,["placeholder"]),n(G,{class:"search-icon",src:w,mode:"aspectFit"})])),_:1},8,["onClick"])])),_:1}),n(D,{class:"tab-container"},{default:c((()=>[(o(!0),i(u,null,d(C.categories,((a,s)=>(o(),l(D,{key:s,class:p(["tab-item",{active:C.currentTab===s}]),onClick:a=>x.switchTab(s)},{default:c((()=>[h(b(a.name),1)])),_:2},1032,["class","onClick"])))),128))])),_:1})])),_:1}),n(B,{"scroll-y":"",class:"scroll-container"},{default:c((()=>[n(D,{class:"banner-container"},{default:c((()=>[n(F,{class:"banner-swiper","indicator-dots":"true",autoplay:"true",interval:"5000",circular:"true"},{default:c((()=>[(o(!0),i(u,null,d(C.banners,((a,s)=>(o(),l(P,{key:s},{default:c((()=>[n(G,{class:"banner-image",src:a,mode:"aspectFill"},null,8,["src"])])),_:2},1024)))),128))])),_:1})])),_:1}),n(D,{class:"content"},{default:c((()=>[null!==C.currentTab?(o(),l(D,{key:0,class:"tab-content"},{default:c((()=>[(o(!0),i(u,null,d(C.currentTabData,((a,s)=>(o(),l(D,{key:s,class:"content-item",onClick:s=>x.navigateToProduct(a)},{default:c((()=>[n(D,{class:"product-card"},{default:c((()=>{var s;return[n(G,{class:"item-image",src:null==(s=a.goods_thumb)?void 0:s.fileID,mode:"aspectFit"},null,8,["src"]),n(D,{class:"product-info"},{default:c((()=>[n(j,{class:"item-title"},{default:c((()=>[h(b(a.name),1)])),_:2},1024),n(D,{class:"service-tags"},{default:c((()=>[n(j,{class:"tag pay-later"},{default:c((()=>[h("先用后付")])),_:1}),n(j,{class:"tag quick-refund"},{default:c((()=>[h("极速退款")])),_:1})])),_:1}),n(D,{class:"price-row"},{default:c((()=>[n(j,{class:"price"},{default:c((()=>[h("¥"+b(a.price),1)])),_:2},1024),n(j,{class:"sales"},{default:c((()=>[h("全店已拼"+b(a.total_sell_count)+"+件",1)])),_:2},1024)])),_:2},1024)])),_:2},1024)]})),_:2},1024)])),_:2},1032,["onClick"])))),128))])),_:1})):(o(),l(D,{key:1,class:"loading"},{default:c((()=>[h("加载中...")])),_:1}))])),_:1})])),_:1})])),_:1})}],["__scopeId","data-v-73acfc59"]]);export{x as default};
