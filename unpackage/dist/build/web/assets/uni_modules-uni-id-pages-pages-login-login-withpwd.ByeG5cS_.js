import{n as e,s,a as o,b as i,r as t,c as n,w as a,i as r,o as l,d as u,e as d,f as m,t as c,g as p,h as f,j as g}from"./index-El_S5awX.js";import{_ as h}from"./uni-easyinput.DbGGs_zh.js";import{r as w}from"./uni-app.es.DUfiIcRS.js";import{_}from"./uni-forms-item.Dh8EZ7zM.js";import{_ as x}from"./uni-forms.CLYAXFuX.js";import{m as j}from"./login-page.mixin.DD2Ubhug.js";import{_ as k}from"./logo.VQCJtlH9.js";import{_ as y}from"./_plugin-vue_export-helper.BCo6x5W8.js";import"./uni-icons.Bmz5z2vR.js";import"./store.D9vwEKqx.js";const C=e.importObject("uni-id-co",{errorOptions:{type:"toast"}});const b=y({mixins:[j],data:()=>({password:"",username:"",focusUsername:!1,focusPassword:!1,logo:"/static/logo.png"}),onShow(){document.onkeydown=e=>{var s=e||window.event;s&&13==s.keyCode&&this.pwdLogin()}},methods:{toRetrievePwd(){s({icon:"error",title:"该功能暂未实现"})},pwdLogin(){if(!this.username.length)return this.focusUsername=!0,s({title:"请输入用户名",icon:"none",duration:3e3});if(!this.password.length)return this.focusPassword=!0,s({title:"请输入密码",icon:"none",duration:3e3});if(this.needAgreements&&!this.agree)return this.$refs.agreements.popup(this.pwdLogin);let e={password:this.password};/^1\d{10}$/.test(this.username)?e.mobile=this.username:/@/.test(this.username)?e.email=this.username:e.username=this.username,C.login(e).then((e=>{this.loginSuccess(e),s({title:"登录成功",icon:"success",duration:1e3}),setTimeout((()=>{o({url:"/pages/index/index"})}),1e3)})).catch((e=>{console.error("登录失败：",e);let o="登录失败，请重试";"uni-id-captcha-required"===e.errCode?o="需要验证码登录，请稍后重试":e.message&&(o=e.message),s({title:o,icon:"none",duration:3e3})}))},toRegister(){i({url:this.config.isAdmin?"/uni_modules/uni-id-pages/pages/register/register-admin":"/uni_modules/uni-id-pages/pages/register/register",fail(e){console.error(e)}})},wechat(){i({url:"/uni_modules/uni-id-pages/pages/login/login-withoutpwd"})}}},[["render",function(e,s,o,i,j,y){const C=p,b=r,v=w(t("uni-easyinput"),h),P=w(t("uni-forms-item"),_),U=w(t("uni-forms"),x),V=f,A=g;return l(),n(b,{class:"login-container"},{default:a((()=>[u(b,{class:"login-content"},{default:a((()=>[u(b,{class:"login-logo"},{default:a((()=>[u(C,{src:k,mode:"widthFix",class:"logo-image"})])),_:1}),u(U,{class:"form-container"},{default:a((()=>[u(P,{name:"username"},{default:a((()=>[u(v,{focus:j.focusUsername,onBlur:s[0]||(s[0]=e=>j.focusUsername=!1),class:"input-box username-input",inputBorder:!1,modelValue:j.username,"onUpdate:modelValue":s[1]||(s[1]=e=>j.username=e),placeholder:"请输入用户名",trim:"all"},null,8,["focus","modelValue"])])),_:1}),u(P,{name:"password"},{default:a((()=>[u(v,{focus:j.focusPassword,onBlur:s[2]||(s[2]=e=>j.focusPassword=!1),class:"input-box password-input",clearable:"",type:"password",inputBorder:!1,modelValue:j.password,"onUpdate:modelValue":s[3]||(s[3]=e=>j.password=e),placeholder:"请输入密码",trim:"all"},null,8,["focus","modelValue"])])),_:1})])),_:1}),u(V,{class:"login-button",type:"primary",onClick:y.pwdLogin},{default:a((()=>[d("登录")])),_:1},8,["onClick"]),u(b,{class:"link-container"},{default:a((()=>[e.config.isAdmin?m("",!0):(l(),n(b,{key:0},{default:a((()=>[u(A,{class:"link-text retrieve-pwd",onClick:y.toRetrievePwd},{default:a((()=>[d("忘记密码")])),_:1},8,["onClick"])])),_:1})),u(A,{class:"link-text register",onClick:y.toRegister},{default:a((()=>[d(c(e.config.isAdmin?"注册管理员账号":"注册账号"),1)])),_:1},8,["onClick"])])),_:1})])),_:1})])),_:1})}],["__scopeId","data-v-b00ecea8"]]);export{b as default};
