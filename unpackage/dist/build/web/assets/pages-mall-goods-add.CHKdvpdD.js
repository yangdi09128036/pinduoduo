import{n as e,r as t,o as l,c as a,w as s,e as o,t as i,q as d,F as n,x as r,u,v as c,d as m,f as h,j as f,i as _,a0 as p,a1 as g,a2 as y,ar as b,as as D,B as k,C as V,s as v,z as x,E as C,ap as S,h as L}from"./index-CDX771vS.js";import{_ as w}from"./uni-easyinput.D9N1AZ_4.js";import{r as I}from"./uni-app.es.i-bVV8oK.js";import{_ as T}from"./uni-forms-item.8sfQ-SvQ.js";import{v as $,_ as E}from"./mall-goods.ByehVgJr.js";import{_ as j}from"./uni-load-more.CvNHBxiU.js";import{_ as F}from"./_plugin-vue_export-helper.BCo6x5W8.js";import{_ as U}from"./uni-forms.Cwp0nF62.js";import"./uni-icons.D1MAE8uI.js";const B=F({name:"uniDataChecklist",mixins:[e.mixinDatacom||{}],emits:["input","update:modelValue","change"],props:{mode:{type:String,default:"default"},multiple:{type:Boolean,default:!1},value:{type:[Array,String,Number],default:()=>""},modelValue:{type:[Array,String,Number],default:()=>""},localdata:{type:Array,default:()=>[]},min:{type:[Number,String],default:""},max:{type:[Number,String],default:""},wrap:{type:Boolean,default:!1},icon:{type:String,default:"left"},selectedColor:{type:String,default:""},selectedTextColor:{type:String,default:""},emptyText:{type:String,default:"暂无数据"},disabled:{type:Boolean,default:!1},map:{type:Object,default:()=>({text:"text",value:"value"})}},watch:{localdata:{handler(e){this.range=e,this.dataList=this.getDataList(this.getSelectedValue(e))},deep:!0},mixinDatacomResData(e){this.range=e,this.dataList=this.getDataList(this.getSelectedValue(e))},value(e){this.dataList=this.getDataList(e)},modelValue(e){this.dataList=this.getDataList(e)}},data:()=>({dataList:[],range:[],contentText:{contentdown:"查看更多",contentrefresh:"加载中",contentnomore:"没有更多"},isLocal:!0,styles:{selectedColor:"#2979ff",selectedTextColor:"#666"},isTop:0}),computed:{dataValue(){return""===this.value?this.modelValue:(this.modelValue,this.value)}},created(){this.localdata&&0!==this.localdata.length?(this.isLocal=!0,this.range=this.localdata,this.dataList=this.getDataList(this.getSelectedValue(this.range))):this.collection&&(this.isLocal=!1,this.loadData())},methods:{loadData(){this.mixinDatacomGet().then((e=>{this.mixinDatacomResData=e.result.data,0===this.mixinDatacomResData.length?(this.isLocal=!1,this.mixinDatacomErrorMessage=this.emptyText):this.isLocal=!0})).catch((e=>{this.mixinDatacomErrorMessage=e.message}))},getForm(e="uniForms"){let t=this.$parent,l=t.$options.name;for(;l!==e;){if(t=t.$parent,!t)return!1;l=t.$options.name}return t},change(e){const t=e.detail.value;let l={value:[],data:[]};if(this.multiple)this.range.forEach((e=>{t.includes(e[this.map.value]+"")&&(l.value.push(e[this.map.value]),l.data.push(e))}));else{const e=this.range.find((e=>e[this.map.value]+""===t));e&&(l={value:e[this.map.value],data:e})}this.$emit("input",l.value),this.$emit("update:modelValue",l.value),this.$emit("change",{detail:l}),this.multiple?this.dataList=this.getDataList(l.value,!0):this.dataList=this.getDataList(l.value)},getDataList(e){let t=JSON.parse(JSON.stringify(this.range)),l=[];return this.multiple?Array.isArray(e)||(e=[]):Array.isArray(e)&&e.length&&(e=e[0]),t.forEach(((t,a)=>{if(t.disabled=t.disable||t.disabled||!1,this.multiple)if(e.length>0){let l=e.find((e=>e===t[this.map.value]));t.selected=void 0!==l}else t.selected=!1;else t.selected=e===t[this.map.value];l.push(t)})),this.setRange(l)},setRange(e){let t=e.filter((e=>e.selected)),l=Number(this.min)||0,a=Number(this.max)||"";return e.forEach(((s,o)=>{if(this.multiple){if(t.length<=l){void 0!==t.find((e=>e[this.map.value]===s[this.map.value]))&&(s.disabled=!0)}if(t.length>=a&&""!==a){void 0===t.find((e=>e[this.map.value]===s[this.map.value]))&&(s.disabled=!0)}}this.setStyles(s,o),e[o]=s})),e},setStyles(e,t){e.styleBackgroud=this.setStyleBackgroud(e),e.styleIcon=this.setStyleIcon(e),e.styleIconText=this.setStyleIconText(e),e.styleRightIcon=this.setStyleRightIcon(e)},getSelectedValue(e){if(!this.multiple)return this.dataValue;let t=[];return e.forEach((e=>{e.selected&&t.push(e[this.map.value])})),this.dataValue.length>0?this.dataValue:t},setStyleBackgroud(e){let t={},l=this.selectedColor?this.selectedColor:"#2979ff";this.selectedColor&&("list"!==this.mode&&(t["border-color"]=e.selected?l:"#DCDFE6"),"tag"===this.mode&&(t["background-color"]=e.selected?l:"#f5f5f5"));let a="";for(let s in t)a+=`${s}:${t[s]};`;return a},setStyleIcon(e){let t={},l="";if(this.selectedColor){let l=this.selectedColor?this.selectedColor:"#2979ff";t["background-color"]=e.selected?l:"#fff",t["border-color"]=e.selected?l:"#DCDFE6",!e.selected&&e.disabled&&(t["background-color"]="#F2F6FC",t["border-color"]=e.selected?l:"#DCDFE6")}for(let a in t)l+=`${a}:${t[a]};`;return l},setStyleIconText(e){let t={},l="";if(this.selectedColor){let l=this.selectedColor?this.selectedColor:"#2979ff";"tag"===this.mode?t.color=e.selected?this.selectedTextColor?this.selectedTextColor:"#fff":"#666":t.color=e.selected?this.selectedTextColor?this.selectedTextColor:l:"#666",!e.selected&&e.disabled&&(t.color="#999")}for(let a in t)l+=`${a}:${t[a]};`;return l},setStyleRightIcon(e){let t={},l="";"list"===this.mode&&(t["border-color"]=e.selected?this.styles.selectedColor:"#DCDFE6");for(let a in t)l+=`${a}:${t[a]};`;return l}}},[["render",function(e,k,V,v,x,C){const S=I(t("uni-load-more"),j),L=f,w=_,T=p,$=g,E=y,F=b,U=D;return l(),a(w,{class:"uni-data-checklist",style:c({"margin-top":x.isTop+"px"})},{default:s((()=>[x.isLocal?(l(),d(n,{key:1},[V.multiple?(l(),a(E,{key:0,class:r(["checklist-group",{"is-list":"list"===V.mode||V.wrap}]),onChange:C.change},{default:s((()=>[(l(!0),d(n,null,u(x.dataList,((e,t)=>(l(),a($,{class:r(["checklist-box",["is--"+V.mode,e.selected?"is-checked":"",V.disabled||e.disabled?"is-disable":"",0!==t&&"list"===V.mode?"is-list-border":""]]),style:c(e.styleBackgroud),key:t},{default:s((()=>[m(T,{class:"hidden",hidden:"",disabled:V.disabled||!!e.disabled,value:e[V.map.value]+"",checked:e.selected},null,8,["disabled","value","checked"]),"tag"!==V.mode&&"list"!==V.mode||"list"===V.mode&&"left"===V.icon?(l(),a(w,{key:0,class:"checkbox__inner",style:c(e.styleIcon)},{default:s((()=>[m(w,{class:"checkbox__inner-icon"})])),_:2},1032,["style"])):h("",!0),m(w,{class:r(["checklist-content",{"list-content":"list"===V.mode&&"left"===V.icon}])},{default:s((()=>[m(L,{class:"checklist-text",style:c(e.styleIconText)},{default:s((()=>[o(i(e[V.map.text]),1)])),_:2},1032,["style"]),"list"===V.mode&&"right"===V.icon?(l(),a(w,{key:0,class:"checkobx__list",style:c(e.styleBackgroud)},null,8,["style"])):h("",!0)])),_:2},1032,["class"])])),_:2},1032,["class","style"])))),128))])),_:1},8,["class","onChange"])):(l(),a(U,{key:1,class:r(["checklist-group",{"is-list":"list"===V.mode,"is-wrap":V.wrap}]),onChange:C.change},{default:s((()=>[(l(!0),d(n,null,u(x.dataList,((e,t)=>(l(),a($,{class:r(["checklist-box",["is--"+V.mode,e.selected?"is-checked":"",V.disabled||e.disabled?"is-disable":"",0!==t&&"list"===V.mode?"is-list-border":""]]),style:c(e.styleBackgroud),key:t},{default:s((()=>[m(F,{class:"hidden",hidden:"",disabled:V.disabled||e.disabled,value:e[V.map.value]+"",checked:e.selected},null,8,["disabled","value","checked"]),"tag"!==V.mode&&"list"!==V.mode||"list"===V.mode&&"left"===V.icon?(l(),a(w,{key:0,class:"radio__inner",style:c(e.styleBackgroud)},{default:s((()=>[m(w,{class:"radio__inner-icon",style:c(e.styleIcon)},null,8,["style"])])),_:2},1032,["style"])):h("",!0),m(w,{class:r(["checklist-content",{"list-content":"list"===V.mode&&"left"===V.icon}])},{default:s((()=>[m(L,{class:"checklist-text",style:c(e.styleIconText)},{default:s((()=>[o(i(e[V.map.text]),1)])),_:2},1032,["style"]),"list"===V.mode&&"right"===V.icon?(l(),a(w,{key:0,style:c(e.styleRightIcon),class:"checkobx__list"},null,8,["style"])):h("",!0)])),_:2},1032,["class"])])),_:2},1032,["class","style"])))),128))])),_:1},8,["class","onChange"]))],64)):(l(),a(w,{key:0,class:"uni-data-loading"},{default:s((()=>[e.mixinDatacomErrorMessage?(l(),a(L,{key:1},{default:s((()=>[o(i(e.mixinDatacomErrorMessage),1)])),_:1})):(l(),a(S,{key:0,status:"loading",iconType:"snow",iconSize:18,"content-text":x.contentText},null,8,["content-text"]))])),_:1}))])),_:1},8,["style"])}],["__scopeId","data-v-3c7770c3"]]),R=e.database();function N(e){let t={};for(let l in $)e.indexOf(l)>-1&&(t[l]=$[l]);return t}const A=F({data(){let e={category_id:"",goods_sn:"",name:"",price:null,keywords:"",goods_desc:"",goods_thumb:null,goods_banner_imgs:[],reviews:[],remain_count:null,month_sell_count:null,total_sell_count:null,is_real:null,is_on_sale:null,is_best:null,is_new:null,is_hot:null,seller_note:""};return{formData:e,formOptions:{},rules:{...N(Object.keys(e))}}},onReady(){this.$refs.form.setRules(this.rules)},methods:{submit(){k({mask:!0}),this.$refs.form.validate().then((e=>this.submitForm(e))).catch((()=>{})).finally((()=>{V()}))},submitForm(e){return R.collection("mall-goods").add(e).then((e=>{v({icon:"none",title:"新增成功"}),this.getOpenerEventChannel().emit("refreshData"),setTimeout((()=>x()),500)})).catch((e=>{C({content:e.message||"请求服务失败",showCancel:!1})}))}}},[["render",function(e,i,d,n,r,u){const c=I(t("uni-easyinput"),w),h=I(t("uni-forms-item"),T),f=I(t("uni-file-picker"),E),p=I(t("uni-data-checkbox"),B),g=S,y=L,b=_,D=I(t("uni-forms"),U);return l(),a(b,{class:"uni-container"},{default:s((()=>[m(D,{ref:"form",model:r.formData,"validate-trigger":"submit","err-show-type":"toast"},{default:s((()=>[m(h,{name:"category_id",label:"商品类别 ID",required:""},{default:s((()=>[m(c,{placeholder:"商品所属的分类 ID，参考 `opendb-mall-categories` 表。",modelValue:r.formData.category_id,"onUpdate:modelValue":i[0]||(i[0]=e=>r.formData.category_id=e)},null,8,["modelValue"])])),_:1}),m(h,{name:"goods_sn",label:"货号",required:""},{default:s((()=>[m(c,{placeholder:"商品的唯一货号，用于区分不同商品。",modelValue:r.formData.goods_sn,"onUpdate:modelValue":i[1]||(i[1]=e=>r.formData.goods_sn=e),trim:"both"},null,8,["modelValue"])])),_:1}),m(h,{name:"name",label:"商品名称",required:""},{default:s((()=>[m(c,{placeholder:"商品的名称，用于展示和搜索。",modelValue:r.formData.name,"onUpdate:modelValue":i[2]||(i[2]=e=>r.formData.name=e),trim:"both"},null,8,["modelValue"])])),_:1}),m(h,{name:"price",label:"商品价格",required:""},{default:s((()=>[m(c,{placeholder:"商品的售价，单位为元。",type:"number",modelValue:r.formData.price,"onUpdate:modelValue":i[3]||(i[3]=e=>r.formData.price=e)},null,8,["modelValue"])])),_:1}),m(h,{name:"keywords",label:"关键字"},{default:s((()=>[m(c,{placeholder:"商品的关键字，用于搜索引擎收录。",modelValue:r.formData.keywords,"onUpdate:modelValue":i[4]||(i[4]=e=>r.formData.keywords=e),trim:"both"},null,8,["modelValue"])])),_:1}),m(h,{name:"goods_desc",label:"详细描述"},{default:s((()=>[m(c,{placeholder:"商品的详细描述，支持多行文本。",modelValue:r.formData.goods_desc,"onUpdate:modelValue":i[5]||(i[5]=e=>r.formData.goods_desc=e),trim:"both"},null,8,["modelValue"])])),_:1}),m(h,{name:"goods_thumb",label:"缩略图"},{default:s((()=>[m(f,{"return-type":"object",modelValue:r.formData.goods_thumb,"onUpdate:modelValue":i[6]||(i[6]=e=>r.formData.goods_thumb=e)},null,8,["modelValue"])])),_:1}),m(h,{name:"goods_banner_imgs",label:"Banner 图"},{default:s((()=>[m(p,{multiple:!0,modelValue:r.formData.goods_banner_imgs,"onUpdate:modelValue":i[7]||(i[7]=e=>r.formData.goods_banner_imgs=e)},null,8,["modelValue"])])),_:1}),m(h,{name:"reviews",label:"商品评价"},{default:s((()=>[m(p,{multiple:!0,modelValue:r.formData.reviews,"onUpdate:modelValue":i[8]||(i[8]=e=>r.formData.reviews=e)},null,8,["modelValue"])])),_:1}),m(h,{name:"remain_count",label:"库存数量"},{default:s((()=>[m(c,{placeholder:"商品的剩余库存数量。",type:"number",modelValue:r.formData.remain_count,"onUpdate:modelValue":i[9]||(i[9]=e=>r.formData.remain_count=e)},null,8,["modelValue"])])),_:1}),m(h,{name:"month_sell_count",label:"月销量"},{default:s((()=>[m(c,{placeholder:"商品在本月的销售数量。",type:"number",modelValue:r.formData.month_sell_count,"onUpdate:modelValue":i[10]||(i[10]=e=>r.formData.month_sell_count=e)},null,8,["modelValue"])])),_:1}),m(h,{name:"total_sell_count",label:"总销量"},{default:s((()=>[m(c,{placeholder:"商品的累计销售数量。",type:"number",modelValue:r.formData.total_sell_count,"onUpdate:modelValue":i[11]||(i[11]=e=>r.formData.total_sell_count=e)},null,8,["modelValue"])])),_:1}),m(h,{name:"is_real",label:"是否为实物"},{default:s((()=>[m(g,{onChange:i[12]||(i[12]=t=>e.binddata("is_real",t.detail.value)),checked:r.formData.is_real},null,8,["checked"])])),_:1}),m(h,{name:"is_on_sale",label:"是否上架"},{default:s((()=>[m(g,{onChange:i[13]||(i[13]=t=>e.binddata("is_on_sale",t.detail.value)),checked:r.formData.is_on_sale},null,8,["checked"])])),_:1}),m(h,{name:"is_best",label:"是否精品"},{default:s((()=>[m(g,{onChange:i[14]||(i[14]=t=>e.binddata("is_best",t.detail.value)),checked:r.formData.is_best},null,8,["checked"])])),_:1}),m(h,{name:"is_new",label:"是否新品"},{default:s((()=>[m(g,{onChange:i[15]||(i[15]=t=>e.binddata("is_new",t.detail.value)),checked:r.formData.is_new},null,8,["checked"])])),_:1}),m(h,{name:"is_hot",label:"是否热销"},{default:s((()=>[m(g,{onChange:i[16]||(i[16]=t=>e.binddata("is_hot",t.detail.value)),checked:r.formData.is_hot},null,8,["checked"])])),_:1}),m(h,{name:"seller_note",label:"商家备注"},{default:s((()=>[m(c,{placeholder:"商家对商品的备注信息，仅商家可见。",modelValue:r.formData.seller_note,"onUpdate:modelValue":i[17]||(i[17]=e=>r.formData.seller_note=e),trim:"both"},null,8,["modelValue"])])),_:1}),m(b,{class:"uni-button-group"},{default:s((()=>[m(y,{type:"primary",class:"uni-button",onClick:u.submit},{default:s((()=>[o("提交")])),_:1},8,["onClick"])])),_:1})])),_:1},8,["model"])])),_:1})}],["__scopeId","data-v-361f31c6"]]);export{A as default};
