import{n as e,B as i,C as o,D as n,r as s,o as t,c as a,w as l,d as u,e as r,j as c,h as d,i as p,b as m,s as f,f as h,q as g,F as b}from"./index-CDX771vS.js";import{_ as y}from"./uni-id-pages-avatar.CBt3RajW.js";import{r as _}from"./uni-app.es.i-bVV8oK.js";import{_ as k,a as w}from"./uni-list.BioAR-uY.js";import{_ as v}from"./uni-popup-dialog.DPl9YtSD.js";import{_ as I}from"./uni-popup.DpjIGWmU.js";import{_ as M}from"./_plugin-vue_export-helper.BCo6x5W8.js";import{s as x,m as C}from"./store.Pgya9fdc.js";import"./uni-icons.D1MAE8uI.js";e.database().collection("uni-id-users");const S=e.importObject("uni-id-co");const B=M({emits:["success"],computed:{},data:()=>({}),methods:{beforeGetphonenumber:async()=>await new Promise(((s,t)=>{i({mask:!0}),wx.checkSession({success(){s(),o()},fail(){n({success({code:i}){e.importObject("uni-id-co",{customUI:!0}).loginByWeixin({code:i}).then((e=>{s()})).catch((e=>{console.log(e),t()})).finally((e=>{o()}))},fail:e=>{console.error(e),t()}})}})})),async bindMobileByMpWeixin(e){"getPhoneNumber:ok"==e.detail.errMsg?(await this.beforeGetphonenumber(),S.bindMobileByMpWeixin(e.detail).then((e=>{this.$emit("success")})).finally((e=>{this.closeMe()}))):this.closeMe()},async open(){this.$refs.popup.open()},closeMe(e){this.$refs.popup.close()}}},[["render",function(e,i,o,n,m,f){const h=c,g=d,b=p,y=_(s("uni-popup"),I);return t(),a(y,{ref:"popup",type:"bottom"},{default:l((()=>[u(b,{class:"box"},{default:l((()=>[u(h,{class:"headBox"},{default:l((()=>[r("绑定资料")])),_:1}),u(h,{class:"tip"},{default:l((()=>[r("将一键获取你的手机号码绑定你的个人资料")])),_:1}),u(b,{class:"btnBox"},{default:l((()=>[u(h,{onClick:f.closeMe,class:"close"},{default:l((()=>[r("关闭")])),_:1},8,["onClick"]),u(g,{class:"agree uni-btn",type:"primary","open-type":"getPhoneNumber",onGetphonenumber:f.bindMobileByMpWeixin},{default:l((()=>[r("获取")])),_:1},8,["onGetphonenumber"])])),_:1})])),_:1})])),_:1},512)}],["__scopeId","data-v-1edc5089"]]),j=e.importObject("uni-id-co");const N=M({computed:{userInfo:()=>x.userInfo,realNameStatus(){return this.userInfo.realNameAuth?this.userInfo.realNameAuth.authStatus:0}},data:()=>({univerifyStyle:{authButton:{title:"本机号码一键绑定"},otherLoginButton:{title:"其他号码绑定"}},hasPwd:!1,showLoginManage:!1,setNicknameIng:!1}),async onShow(){this.univerifyStyle.authButton.title="本机号码一键绑定",this.univerifyStyle.otherLoginButton.title="其他号码绑定"},async onLoad(e){e.showLoginManage&&(this.showLoginManage=!0);let i=await j.getAccountInfo();this.hasPwd=i.isPasswordSet},methods:{login(){m({url:"/uni_modules/uni-id-pages/pages/login/login-withoutpwd",complete:e=>{}})},logout(){C.logout()},bindMobileSuccess(){C.updateUserInfo()},changePassword(){m({url:"/uni_modules/uni-id-pages/pages/userinfo/change_pwd/change_pwd",complete:e=>{}})},bindMobile(){this.bindMobileBySmsCode()},univerify(){n({provider:"univerify",univerifyStyle:this.univerifyStyle,success:async e=>{j.bindMobileByUniverify(e.authResult).then((e=>{C.updateUserInfo()})).catch((e=>{console.log(e)})).finally((e=>{uni.closeAuthView()}))},fail:e=>{console.log(e),"30002"!=e.code&&"30001"!=e.code||this.bindMobileBySmsCode()}})},bindMobileBySmsCode(){m({url:"./bind-mobile/bind-mobile"})},setNickname(e){e?(C.updateUserInfo({nickname:e}),this.setNicknameIng=!1,this.$refs.dialog.close()):this.$refs.dialog.open()},deactivate(){m({url:"/uni_modules/uni-id-pages/pages/userinfo/deactivate/deactivate"})},async bindThirdAccount(i){const s=e.importObject("uni-id-co"),t={weixin:"wx_openid",alipay:"ali_openid",apple:"apple_openid",qq:"qq_openid"}[i.toLowerCase()];this.userInfo[t]?(await s["unbind"+i](),await C.updateUserInfo()):n({provider:i.toLowerCase(),onlyAuthorize:!0,success:async e=>{const o=await s["bind"+i]({code:e.code});o.errCode&&f({title:o.errMsg||"绑定失败",duration:3e3}),await C.updateUserInfo()},fail:async e=>{console.log(e),o()}})},realNameVerify(){m({url:"/uni_modules/uni-id-pages/pages/userinfo/realname-verify/realname-verify"})}}},[["render",function(e,i,o,n,c,m){const f=_(s("uni-id-pages-avatar"),y),M=p,x=_(s("uni-list-item"),k),C=_(s("uni-list"),w),S=_(s("uni-popup-dialog"),v),j=_(s("uni-popup"),I),N=_(s("uni-id-pages-bind-mobile"),B),P=d;return t(),a(M,{class:"uni-content"},{default:l((()=>[u(M,{class:"avatar"},{default:l((()=>[u(f,{width:"260rpx",height:"260rpx"})])),_:1}),u(C,null,{default:l((()=>[u(x,{class:"item",onClick:i[0]||(i[0]=e=>m.setNickname("")),title:"昵称",rightText:m.userInfo.nickname||"未设置",link:""},null,8,["rightText"]),u(x,{class:"item",onClick:m.bindMobile,title:"手机号",rightText:m.userInfo.mobile||"未绑定",link:""},null,8,["onClick","rightText"]),m.userInfo.email?(t(),a(x,{key:0,class:"item",title:"电子邮箱",rightText:m.userInfo.email},null,8,["rightText"])):h("",!0),c.hasPwd?(t(),a(x,{key:1,class:"item",onClick:m.changePassword,title:"修改密码",link:""},null,8,["onClick"])):h("",!0)])),_:1}),u(C,{class:"mt10"},{default:l((()=>[u(x,{onClick:m.deactivate,title:"注销账号",link:"navigateTo"},null,8,["onClick"])])),_:1}),u(j,{ref:"dialog",type:"dialog"},{default:l((()=>[u(S,{mode:"input",value:m.userInfo.nickname,onConfirm:m.setNickname,inputType:c.setNicknameIng?"nickname":"text",title:"设置昵称",placeholder:"请输入要设置的昵称"},null,8,["value","onConfirm","inputType"])])),_:1},512),u(N,{ref:"bind-mobile-by-sms",onSuccess:m.bindMobileSuccess},null,8,["onSuccess"]),c.showLoginManage?(t(),g(b,{key:0},[m.userInfo._id?(t(),a(P,{key:0,onClick:m.logout},{default:l((()=>[r("退出登录")])),_:1},8,["onClick"])):(t(),a(P,{key:1,onClick:m.login},{default:l((()=>[r("去登录")])),_:1},8,["onClick"]))],64)):h("",!0)])),_:1})}],["__scopeId","data-v-a98497c8"]]);export{N as default};
