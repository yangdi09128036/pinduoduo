import{n as s,l as e,m as a,p as t,b as r,r as l,c as o,w as u,i as d,o as n,d as c,e as i,t as f,f as p,q as _,u as g,F as m,g as h,j as C}from"./index-CDX771vS.js";import{_ as v}from"./uni-id-pages-avatar.CBt3RajW.js";import{r as w}from"./uni-app.es.i-bVV8oK.js";import{s as k}from"./store.Pgya9fdc.js";import{_ as F,a as y}from"./wallet-red.Cfw-DLU5.js";import{_ as I}from"./_plugin-vue_export-helper.BCo6x5W8.js";import"./uni-icons.D1MAE8uI.js";const b=I({computed:{userInfo:()=>k.userInfo},data:()=>({allGoods:[],randomGoods:[],orderCounts:{1:0,2:0,3:0,4:0,5:0}}),onLoad(){this.getGoods()},onShow(){this.getOrderCounts()},methods:{async getGoods(){try{const{result:{data:e}}=await s.database().collection("mall-goods").get();this.allGoods=e||[],this.randomGoods=this.getRandomGoods(16)}catch(e){console.error("获取商品数据失败:",e)}},getRandomGoods(s){return[...this.allGoods].sort((()=>Math.random()-.5)).slice(0,s)},getOrderCounts(){const s=e("orderCounts");s?this.orderCounts=s:this.fetchOrderCounts()},async fetchOrderCounts(){if(k.userInfo&&k.userInfo._id)try{const e=s.database(),t=await e.collection("order").where({userId:k.userInfo._id,paymentStatus:0}).count();this.orderCounts[1]=t.result.total;const r=await e.collection("order").where({userId:k.userInfo._id,paymentStatus:1,shareStatus:0}).count();this.orderCounts[2]=r.result.total;const l=await e.collection("order").where({userId:k.userInfo._id,paymentStatus:1,shippingStatus:0}).count();this.orderCounts[3]=l.result.total;const o=await e.collection("order").where({userId:k.userInfo._id,shippingStatus:1,deliveryStatus:0}).count();this.orderCounts[4]=o.result.total;const u=await e.collection("order").where({userId:k.userInfo._id,deliveryStatus:1,review:e.command.exists(!1)}).count();this.orderCounts[5]=u.result.total,a("orderCounts",this.orderCounts)}catch(e){console.error("获取订单数量失败:",e)}},navigateToProduct(s){s&&(t({key:"currentProduct",data:s,success:()=>{console.log("商品信息存储成功",s)}}),r({url:"../search/mall-details"}))},navigateToAddress(){r({url:"/pages/address/address"})},viewAllOrders(){r({url:"/pages/user/order"})},navigateToOrder(s){r({url:`/pages/user/order?type=${s}`})},goSet(){r({url:"/pages/user/set"})},navigateToFeature(s){r({url:{favor:"/pages/malls-manage/favor",wallet:"/pages/wallet/wallet",coupon:"/pages/coupon/coupon-list",history:"/pages/malls-manage/history",refund:"/pages/orders/refund-list"}[s]})},goSet(){r({url:"/pages/user/set"})}}},[["render",function(s,e,a,t,r,k){const I=d,b=w(l("uni-id-pages-avatar"),v),T=h,O=C;return n(),o(I,{class:"container"},{default:u((()=>[c(I,{class:"status-bar"}),c(I,{class:"user-header"},{default:u((()=>[c(I,{class:"user-info"},{default:u((()=>[c(I,{class:"avatar-wrapper"},{default:u((()=>[c(b,{width:"100rpx",height:"100rpx"})])),_:1}),c(I,{class:"user-meta"},{default:u((()=>[c(I,{class:"nickname-row"},{default:u((()=>[c(T,{src:"/assets/user-icon-0FLY8y0n.png",mode:"aspectFit",class:"wechat-icon"}),c(O,{class:"nickname"},{default:u((()=>[i(f(k.userInfo.username||"您的昵称"),1)])),_:1})])),_:1}),c(I,{class:"address",onClick:k.goSet},{default:u((()=>[c(T,{src:F,mode:"aspectFit",class:"wechat-icon"}),c(O,{class:"address-text"},{default:u((()=>[i(f(k.userInfo.address&&k.userInfo.address.length>6?k.userInfo.address.substr(0,6)+"...":k.userInfo.address||"收货地址"),1)])),_:1})])),_:1},8,["onClick"])])),_:1})])),_:1}),c(I,{class:"header-buttons"},{default:u((()=>[c(I,{class:"pindan-btn"},{default:u((()=>[c(T,{src:"/assets/coupon-DzltuKQu.png",mode:"aspectFit",class:"settings-icon"}),c(O,null,{default:u((()=>[i("拼单返券")])),_:1})])),_:1}),c(I,{class:"pindan-btn"},{default:u((()=>[c(T,{src:"/assets/set-BJqdCXFW.png",mode:"aspectFit",class:"settings-icon",onClick:k.goSet},null,8,["onClick"]),c(O,null,{default:u((()=>[i("设置")])),_:1})])),_:1})])),_:1})])),_:1}),c(I,{class:"monthly-card"},{default:u((()=>[c(O,{class:"card-title"},{default:u((()=>[i("省钱月卡")])),_:1}),c(O,{class:"card-desc"},{default:u((()=>[i("到账提醒: 124元补贴待领 >")])),_:1})])),_:1}),c(I,{class:"orders-section"},{default:u((()=>[c(I,{class:"orders-header"},{default:u((()=>[c(O,{class:"title"},{default:u((()=>[i("我的订单")])),_:1}),c(I,{class:"view-all",onClick:k.viewAllOrders},{default:u((()=>[c(O,null,{default:u((()=>[i("查看全部")])),_:1}),c(O,{class:"arrow"},{default:u((()=>[i(">")])),_:1})])),_:1},8,["onClick"])])),_:1}),c(I,{class:"order-status"},{default:u((()=>[c(I,{class:"status-item",onClick:e[0]||(e[0]=s=>k.navigateToOrder("pending"))},{default:u((()=>[c(I,{class:"icon-wrapper"},{default:u((()=>[c(T,{src:"/assets/wallet-C4uRVfxV.png",mode:"aspectFit",class:"status-icon"}),r.orderCounts[1]>0?(n(),o(I,{key:0,class:"badge"},{default:u((()=>[i(f(r.orderCounts[1]),1)])),_:1})):p("",!0)])),_:1}),c(O,null,{default:u((()=>[i("待付款")])),_:1})])),_:1}),c(I,{class:"status-item",onClick:e[1]||(e[1]=s=>k.navigateToOrder("share"))},{default:u((()=>[c(I,{class:"icon-wrapper"},{default:u((()=>[c(T,{src:"/assets/share-p-xXMBX_.png",mode:"aspectFit",class:"status-icon"}),r.orderCounts[2]>0?(n(),o(I,{key:0,class:"badge"},{default:u((()=>[i(f(r.orderCounts[2]),1)])),_:1})):p("",!0)])),_:1}),c(O,null,{default:u((()=>[i("待分享")])),_:1})])),_:1}),c(I,{class:"status-item",onClick:e[2]||(e[2]=s=>k.navigateToOrder("shipping"))},{default:u((()=>[c(I,{class:"icon-wrapper"},{default:u((()=>[c(T,{src:"/assets/shipping-HQm6rYkN.png",mode:"aspectFit",class:"status-icon"}),r.orderCounts[3]>0?(n(),o(I,{key:0,class:"badge"},{default:u((()=>[i(f(r.orderCounts[3]),1)])),_:1})):p("",!0)])),_:1}),c(O,null,{default:u((()=>[i("待发货")])),_:1})])),_:1}),c(I,{class:"status-item",onClick:e[3]||(e[3]=s=>k.navigateToOrder("receiving"))},{default:u((()=>[c(I,{class:"icon-wrapper"},{default:u((()=>[c(T,{src:"/assets/delivery-DO47THFz.png",mode:"aspectFit",class:"status-icon"}),r.orderCounts[4]>0?(n(),o(I,{key:0,class:"badge"},{default:u((()=>[i(f(r.orderCounts[4]),1)])),_:1})):p("",!0)])),_:1}),c(O,null,{default:u((()=>[i("待收货")])),_:1})])),_:1}),c(I,{class:"status-item",onClick:e[4]||(e[4]=s=>k.navigateToOrder("review"))},{default:u((()=>[c(I,{class:"icon-wrapper"},{default:u((()=>[c(T,{src:"/assets/star-D6e4F8Ij.png",mode:"aspectFit",class:"status-icon"}),r.orderCounts[5]>0?(n(),o(I,{key:0,class:"badge"},{default:u((()=>[i(f(r.orderCounts[5]),1)])),_:1})):p("",!0)])),_:1}),c(O,null,{default:u((()=>[i("评价")])),_:1})])),_:1})])),_:1})])),_:1}),c(I,{class:"features-section"},{default:u((()=>[c(I,{class:"feature-item",onClick:e[5]||(e[5]=s=>k.navigateToFeature("favor"))},{default:u((()=>[c(T,{src:"/assets/heart-COiJVbcM.png",mode:"aspectFit",class:"feature-icon"}),c(O,null,{default:u((()=>[i("商品收藏")])),_:1})])),_:1}),c(I,{class:"feature-item",onClick:e[6]||(e[6]=s=>k.navigateToFeature("wallet"))},{default:u((()=>[c(T,{src:y,mode:"aspectFit",class:"feature-icon"}),c(O,null,{default:u((()=>[i("多多钱包")])),_:1})])),_:1}),c(I,{class:"feature-item",onClick:e[7]||(e[7]=s=>k.navigateToFeature("coupon"))},{default:u((()=>[c(T,{src:"/assets/coupon-DzltuKQu.png",mode:"aspectFit",class:"feature-icon"}),c(O,null,{default:u((()=>[i("优惠券")])),_:1})])),_:1}),c(I,{class:"feature-item",onClick:e[8]||(e[8]=s=>k.navigateToFeature("history"))},{default:u((()=>[c(T,{src:"/assets/history-xoBvPARg.png",mode:"aspectFit",class:"feature-icon"}),c(O,null,{default:u((()=>[i("历史浏览")])),_:1})])),_:1}),c(I,{class:"feature-item",onClick:e[9]||(e[9]=s=>k.navigateToFeature("refund"))},{default:u((()=>[c(T,{src:"/assets/refund-DL7ljMgG.png",mode:"aspectFit",class:"feature-icon"}),c(O,null,{default:u((()=>[i("退款售后")])),_:1})])),_:1})])),_:1}),c(I,{class:"content"},{default:u((()=>[c(I,{class:"tab-content"},{default:u((()=>[(n(!0),_(m,null,g(r.randomGoods,((s,e)=>(n(),o(I,{key:e,class:"content-item"},{default:u((()=>[c(I,{class:"product-card",onClick:e=>k.navigateToProduct(s)},{default:u((()=>{var e;return[c(T,{class:"item-image",src:null==(e=s.goods_thumb)?void 0:e.fileID,mode:"aspectFill"},null,8,["src"]),c(I,{class:"product-info"},{default:u((()=>[c(O,{class:"item-title"},{default:u((()=>[i(f(s.name),1)])),_:2},1024),c(I,{class:"service-tags"},{default:u((()=>[c(O,{class:"tag pay-later"},{default:u((()=>[i("先用后付")])),_:1}),c(O,{class:"tag quick-refund"},{default:u((()=>[i("极速退款")])),_:1})])),_:1}),c(I,{class:"price-row"},{default:u((()=>[c(O,{class:"price"},{default:u((()=>[i("¥"+f(s.price),1)])),_:2},1024),c(O,{class:"sales"},{default:u((()=>[i("全店已拼"+f(s.total_sell_count)+"+件",1)])),_:2},1024)])),_:2},1024)])),_:2},1024)]})),_:2},1032,["onClick"])])),_:2},1024)))),128))])),_:1})])),_:1})])),_:1})}],["__scopeId","data-v-3da791c2"]]);export{b as default};
