import{n as e,o as t,c as i,w as a,v as s,f as o,g as l,i as r,J as n,B as h,C as d,b as c,P as u,r as p,x as m,h as g}from"./index-CqNzDXlw.js";import{_ as f}from"./_plugin-vue_export-helper.BCo6x5W8.js";import{r as y}from"./uni-app.es.BltvyIiY.js";import{_ as w}from"./uni-icons.EE9020IA.js";import{s as v,m as _}from"./store.DvWIVlV-.js";const I=f({name:"cloud-image",emits:["click"],props:{mode:{type:String,default:()=>"widthFix"},src:{default:()=>""},width:{type:String,default:()=>"100rpx"},height:{type:String,default:()=>"100rpx"}},watch:{src:{handler(t){t&&"cloud://"==t.substring(0,8)?e.getTempFileURL({fileList:[t]}).then((e=>{this.cSrc=e.fileList[0].tempFileURL})):this.cSrc=t},immediate:!0}},methods:{onClick(){this.$emit("click")}},data:()=>({cSrc:!1})},[["render",function(e,n,h,d,c,u){const p=l,m=r;return t(),i(m,{onClick:u.onClick,style:s([{width:h.width,height:h.height},{"justify-content":"center"}])},{default:a((()=>[c.cSrc?(t(),i(p,{key:0,style:s({width:h.width,height:h.height}),src:c.cSrc,mode:h.mode},null,8,["style","src","mode"])):o("",!0)])),_:1},8,["onClick","style"])}]]);const k=f({data:()=>({isPC:!1}),props:{width:{type:String,default:()=>"50px"},height:{type:String,default:()=>"50px"},border:{type:Boolean,default:()=>!1}},async mounted(){this.isPC=!["ios","android"].includes(n().platform)},computed:{hasLogin:()=>v.hasLogin,userInfo:()=>v.userInfo,avatar_file:()=>v.userInfo.avatar_file},methods:{setAvatarFile(e){_.updateUserInfo({avatar_file:e})},async bindchooseavatar(t){let i=t.detail.avatarUrl,a={extname:i.split(".")[i.split(".").length-1],name:"",url:""},s=this.userInfo._id+""+Date.now();a.name=s;try{h({title:"更新中",mask:!0});let{fileID:t}=await e.uploadFile({filePath:i,cloudPath:s,fileType:"image"});a.url=t,d()}catch(o){console.error(o)}console.log("avatar_file",a),this.setAvatarFile(a)},uploadAvatarImg(t){if(!this.hasLogin)return c({url:"/uni_modules/uni-id-pages/pages/login/login-withoutpwd"});const i={quality:100,width:600,height:600,resize:!0};u({count:1,crop:i,success:async t=>{let a=t.tempFiles[0],s={extname:a.name.split(".")[a.name.split(".").length-1]},o=t.tempFilePaths[0];this.isPC||(o=await new Promise((e=>{c({url:"/uni_modules/uni-id-pages/pages/userinfo/cropImage/cropImage?path="+o+`&options=${JSON.stringify(i)}`,animationType:"fade-in",events:{success:t=>{e(t)}},complete(e){console.log(e)}})})));let l=this.userInfo._id+""+Date.now();s.name=l,h({title:"更新中",mask:!0});let{fileID:r}=await e.uploadFile({filePath:o,cloudPath:l,fileType:"image"});s.url=r,d(),this.setAvatarFile(s)}})}}},[["render",function(e,o,l,r,n,h){const d=y(p("cloud-image"),I),c=y(p("uni-icons"),w),u=g;return t(),i(u,{"open-type":"chooseAvatar",onChooseavatar:h.bindchooseavatar,onClick:h.uploadAvatarImg,class:m(["box",{showBorder:l.border}]),style:s({width:l.width,height:l.height,lineHeight:l.height})},{default:a((()=>[h.avatar_file?(t(),i(d,{key:0,src:h.avatar_file.url,width:l.width,height:l.height},null,8,["src","width","height"])):(t(),i(c,{key:1,style:s({width:l.width,height:l.height,lineHeight:l.height}),class:"chooseAvatar",type:"plusempty",size:"30",color:"#dddddd"},null,8,["style"]))])),_:1},8,["onChooseavatar","onClick","class","style"])}],["__scopeId","data-v-4fc3dad3"]]);export{k as _};
